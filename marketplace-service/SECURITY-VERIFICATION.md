# Verificação de Dependências - Gradle

## Problema Identificado pelo SonarQube

O SonarQube identificou a regra **kotlin:S6474**: "Dependencies are not verified because the verification-metadata.xml file is missing."

Isso significa que as dependências baixadas do Maven Central não estão sendo verificadas quanto à sua integridade e autenticidade, o que representa um risco de segurança.

## Solução

O Gradle oferece um mecanismo de verificação de dependências através do arquivo `gradle/verification-metadata.xml` que contém checksums (SHA-256) de todos os artefatos.

### Passo 1: Gerar o arquivo de verificação

```bash
./gradlew --write-verification-metadata sha256 help
```

### Passo 2: Capturar todas as dependências

Para garantir que TODAS as dependências (incluindo as de teste) sejam capturadas:

```bash
./gradlew clean build --write-verification-metadata sha256
```

Isso irá:
- Baixar todas as dependências
- Calcular os checksums SHA-256
- Atualizar o arquivo `gradle/verification-metadata.xml`

### Passo 3: Verificar o arquivo gerado

O arquivo `gradle/verification-metadata.xml` deve conter entradas como:

```xml
<component group="org.springframework.boot" name="spring-boot-starter-web" version="4.0.2">
    <artifact name="spring-boot-starter-web-4.0.2.jar">
        <sha256 value="abc123..." origin="Generated by Gradle"/>
    </artifact>
</component>
```

### Passo 4: Commitar o arquivo

```bash
git add gradle/verification-metadata.xml
git commit -m "feat: adiciona verificação de integridade das dependências"
```

## Como funciona

A partir de agora, toda vez que o Gradle baixar uma dependência, ele irá:

1. Calcular o checksum SHA-256 do arquivo baixado
2. Comparar com o valor no `verification-metadata.xml`
3. Falhar o build se os checksums não coincidirem

Isso protege contra:
- Dependências corrompidas
- Ataques man-in-the-middle
- Repositórios comprometidos
- Substituição maliciosa de artefatos

## Manutenção

Quando adicionar novas dependências:

```bash
./gradlew --write-verification-metadata sha256
```

Ou configure o Gradle para atualizar automaticamente em modo "lenient":

```kotlin
// Em settings.gradle.kts
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
}
```

## Referências

- [Gradle Dependency Verification](https://docs.gradle.org/current/userguide/dependency_verification.html)
- [SonarQube Rule S6474](https://rules.sonarsource.com/kotlin/RSPEC-6474)